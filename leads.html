<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>TopSeller лиды | Лиды</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="icon" href="/assets/images/favicon/favicon.ico">

    <link rel="stylesheet" href="/assets/css/plugins/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/icons/icons.min.css">
    <link href="http://fonts.googleapis.com/css?family=Raleway:300,400,600,700%7COpen+Sans:300,400,600,700%7CHandlee" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/plugins/plugins.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="//cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">

    <!-- RESPONSIVE FIXES -->
    <link rel="stylesheet" href="/assets/css/responsive.css">
    <link rel="stylesheet" href="/assets/css/colors/midnight-blue.css" title="midnight-blue">
    <!--[if lt IE 9]>
            <script src="/assets/js/plugins/html5shiv.min.js"></script>
            <script src="/assets/js/plugins/respond.min.js"></script>
    <![endif]-->

</head>

<body>

<div class="main-wrapper">
    <div class="preloader">
        <div class="loader-container">
            <div class="text-logo">TopSeller</div>
            <div class="signal"></div>
        </div>
    </div>
    <header id="top" >
            <div class="overlay" style="height: 50px; background: rgba(44, 62, 80, 1);">
                <nav class="navbar" role="navigation">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-12">
                                <!-- Navbar-Header -->
                                <div class="navbar-header">
                                    <!-- Mobile Menu -->
                                    <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
                                        <i class="icon icon_menu"></i>
                                    </button>
                                    <!-- Text-Logo -->
                                    <a href="#top" class="navbar-brand scrollto" title="TopSeller">
                                        <span class="text-logo">TopSeller</span>
                                    </a>
                                </div><!-- /End Navbar-Header -->

                                <!-- Navbar-Collapse -->
                                <div class="navbar-collapse collapse">
                                    <ul class="nav navbar-nav navbar-right">
                                        <!-- Menu Items -->
                                        <li><a href="leads.html" title="">Список лидов</a></li>
                                    </ul>
                                </div><!-- /End Navbar-Collapse -->
                            </div><!-- /End Col -->
                        </div><!-- /End Row -->
                    </div><!-- /End Container -->
                </nav><!-- /End Sticky Navigation -->
            </div><!-- /End Background Overlay -->
        </header>

    <div class="container wrapper-xs" id="company">
        <div id="error_msg" style="display:none; text-align: center;">Ошибка при получении данных</div>
        <table id="leads" class="display compact" cellspacing="0" width="100%">
            <thead>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <footer class="footer dark-bg" id="footer">
        <div class="container">
            <div class="wrapper-xs">
                <div class="row">
                    <div class="col-md-12">
                        <p class="footer-copy">&copy; 2016 - TopSeller</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>
</div>

<script src="https://use.fontawesome.com/3533959ff2.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
<script src="/assets/js/plugins/bootstrap.min.js"></script>
<script src="/assets/js/plugins/jquery.easing.1.3.min.js"></script>
<script src="/assets/js/plugins/modernizr.custom.min.js"></script>
<script src="/assets/js/plugins/plugins.min.js"></script>
<script src="/assets/js/custom.js"></script>
<script>
    $(document).ready(function() {
        $.getJSON("http://api.topseller.market/lead")
                .done(function(response) {
                    if (response.status === "success") {
                        var t = $('#leads').DataTable({
                            data: response.data,
                            "columns": [
                                {
                                    "searchable": false,
                                    "orderable": false,
                                    "title": "#",
                                    "data": null
                                },
                                {
                                    "data": "timestamp",
                                    "title": "Дата",
                                    "className": "dt-body-nowrap",
                                    "render": function (date, type, full) {
                                        return new Date(date).toDateString();
                                    }
                                },
                                {"data": "name", "title": "Имя"},
                                {"data": "email", "title": "Email"},
                                {
                                    "data": "company_id",
                                    "searchable": false,
                                    "orderable": false,
                                    "title": "Компания",
                                    "className": "dt-body-center",
                                    "render": function (company_id, type, full) {
                                        return '<a href=' + '/company/'.concat(company_id) + '>' +
                                                '<i class="fa fa-building-o" aria-hidden="true"></i></a>';
                                    }
                                },
                                {
                                    "data": "phones",
                                    "orderable": false,
                                    "title": "Телефон",
                                    "render": function (phones, type, full) {
                                        var data = [];
                                        $.each(phones, function (i, phone) {
                                            var phone_td = phone.country + phone.city + phone.number;
                                            data.push(phone_td);
                                            if (phone.comment !== null)
                                                data.push(phone.comment);
                                        });
                                        return data;
                                    }
                                }
                            ]
                        });
                        t.on('order.dt search.dt', function () {
                            t.column(0, {search: 'applied', order: 'applied'}).nodes().each(function (cell, i) {
                                cell.innerHTML = i + 1;
                            });
                        }).draw();
                    }
                    else {
                        $('#error_msg').show();
                    }
                })
                .fail(function (jqxhr, textStatus, error) {
                    if (typeof jqxhr.responseJSON !== "undefined") {
                        var error_txt = $('#error_msg').text() +
                                "<br>Code: " + jqxhr.responseJSON.code +
                                " Message: " + jqxhr.responseJSON.message;
                        $('#error_msg').html(error_txt);
                    }
                    $('#error_msg').show();
                });
    });
</script>
</body>
</html>